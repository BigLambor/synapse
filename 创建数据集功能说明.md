# 创建数据集功能说明

> **功能状态**: ✅ 已完成  
> **完成时间**: 2024-10-13  
> **组件文件**: `synapse/src/components/organisms/CreateDatasetModal.vue`

---

## 🎯 功能概述

创建数据集表单是一个**三步骤向导式界面**，指导用户创建高质量的AI训练数据集。

### 核心特点
- ✅ **分步骤向导**: 3个清晰的步骤，避免信息过载
- ✅ **实时验证**: 每步验证必填项，确保数据完整
- ✅ **创建者追踪**: 自动记录当前用户信息
- ✅ **智能配置**: 预设选项和智能默认值
- ✅ **视觉反馈**: 进度指示器、状态提示、动画效果

---

## 📋 三步骤流程

### 步骤 1: 基本信息 📝

#### 必填字段
1. **数据集名称** *
   - 例如: "智能座舱用户反馈数据集"
   - 清晰描述数据集用途

2. **数据集描述** *
   - 详细说明：用途、数据类型、适用场景
   - 支持多行输入

3. **数据集分类** *
   - 下拉选择，包括：
     - 用户反馈分析
     - 设计资产
     - 文档分析
     - 语音处理
     - 文本分析
     - 图像识别
     - 视频分析
     - 其他

#### 可选字段
- **版本号**: 默认 1.0.0
- **标签**: 多个标签，支持快速搜索（按Enter添加）

#### 创建者信息显示
自动显示当前登录用户信息：
- 头像 emoji
- 姓名（例如：张三）
- 角色（例如：数据工程师）

**来源**: 从 `useUserStore` 获取当前用户

---

### 步骤 2: 数据配置 ⚙️

#### 1. 数据划分比例
- **训练集**: 默认 80%
- **验证集**: 默认 10%
- **测试集**: 默认 10%

**规则**: 总和必须等于100%

**实时显示**: 根据选择的资产数量，自动计算每个集合的实际数量

#### 2. 标注类型（多选）
支持6种标注类型：

| 类型 | 说明 | 适用场景 |
|:-----|:-----|:---------|
| 🏷️ **分类标注** | 为资产分配类别标签 | 图像分类、文本分类 |
| 📦 **目标检测** | 标注边界框和目标类别 | 目标检测、物体识别 |
| 🎨 **图像分割** | 像素级分割标注 | 语义分割、实例分割 |
| 🔤 **命名实体识别** | 文本实体标注 | NER、知识图谱 |
| 🎤 **转录标注** | 音视频转文字 | ASR、字幕生成 |
| ❓ **问答对** | 问题和答案配对 | QA系统、对话模型 |

#### 3. 标注标签
- 按Enter添加多个标签
- 例如: "语音唤醒失败"、"触控问题"、"UI问题"

#### 4. 质量控制
- ☑️ **需要人工复核**: AI标注后需要人工审核
- 🔢 **最少标注人数**: 每资产最少标注人数（1-5人）

---

### 步骤 3: 选择资产 📦

#### 快速选择预设（演示用）

| 预设 | 资产数量 | 适用场景 |
|:-----|:---------|:---------|
| 📦 **小型数据集** | 100个 | 快速验证 |
| 📊 **中型数据集** | 500个 | 平衡性能和效果 |
| 🏢 **大型数据集** | 1000个 | 生产级训练 |
| ⚙️ **自定义选择** | 手动 | 从数据湖精确选择 |

#### 实时统计显示
选择资产后，自动显示：
- 训练集资产数量
- 验证集资产数量
- 测试集资产数量

**注**: 自定义资产选择器将在后续版本实现

---

## 👤 创建者信息追踪

### 自动记录
创建数据集时，系统自动记录：

```typescript
{
  createdBy: 'user_张三',          // 用户ID
  createdAt: '2024-10-13T10:00:00Z', // 创建时间
  updatedAt: '2024-10-13T10:00:00Z'  // 更新时间
}
```

### 显示位置
1. **创建表单中**: 步骤1底部显示创建者卡片
2. **数据集列表**: 详情中显示创建者
3. **数据集详情**: 完整创建者信息

### 用户来源
```typescript
const userStore = useUserStore()

// 获取当前用户信息
creatorName: userStore.currentUser?.name || '张三'
creatorRole: userStore.currentUser?.role || 'Market Analyst'
creatorAvatar: 根据用户ID映射的emoji头像
```

### 支持的用户角色
- 👩 **张三** - 数据工程师 (Market Analyst)
- 👨 **李四** - AI工程师 (AI Engineer)
- 👩‍💼 **王五** - 技术总监 (Director)

---

## 🎨 UI/UX 设计

### 模态框特性
- **全屏遮罩**: 半透明黑色背景 + 模糊效果
- **居中显示**: 最大宽度 4xl (896px)
- **响应式**: 移动端自动适配
- **优雅动画**: 淡入淡出 + 缩放效果

### 步骤指示器
```
●────●────○
1    2    3
基本  配置  资产
```
- 已完成步骤: 蓝色 + 发光效果
- 当前步骤: 蓝色高亮
- 未完成步骤: 灰色

### 表单验证
- **即时验证**: 输入时实时检查
- **视觉反馈**: 红色提示、黄色警告
- **按钮状态**: 禁用/启用状态明确

### 颜色系统
- **Primary**: 蓝紫色渐变 - 主要操作
- **Success**: 绿色 - 成功状态
- **Warning**: 黄色 - 警告提示
- **Neutral**: 灰色系 - 背景和文本

---

## 🔄 创建流程

### 用户操作流程
```
1. 点击"创建新数据集"按钮
   ↓
2. 打开创建表单Modal
   ↓
3. 步骤1: 填写基本信息
   - 输入名称、描述、分类
   - 添加标签
   - 查看创建者信息
   ↓
4. 点击"下一步" (验证通过)
   ↓
5. 步骤2: 配置数据参数
   - 设置数据划分比例
   - 选择标注类型
   - 添加标注标签
   - 配置质量控制
   ↓
6. 点击"下一步" (验证通过)
   ↓
7. 步骤3: 选择资产
   - 点击预设快速选择
   - 或自定义选择（后续实现）
   - 查看统计信息
   ↓
8. 点击"🎯 创建数据集"
   ↓
9. 后端创建数据集
   - 自动计算划分
   - 生成资产引用
   - 初始化质量指标
   ↓
10. 创建成功
   - 显示成功消息
   - 自动刷新列表
   - 滚动到顶部
   - 关闭Modal
```

### 后端处理逻辑

```typescript
// stores/dataset.ts - createDataset()

1. 接收表单数据
2. 计算数据划分
   - trainCount = totalAssets * train%
   - valCount = totalAssets * validation%
   - testCount = 剩余资产
3. 创建资产引用数组
   - 每个资产分配到对应集合
4. 初始化质量指标（全0）
5. 初始化统计信息
6. 设置状态为 DRAFT
7. 添加到数据集列表
8. 返回新创建的数据集
```

---

## 📊 数据结构

### 创建表单数据
```typescript
{
  name: string              // 数据集名称
  description: string       // 描述
  category: string          // 分类
  version: string           // 版本号
  tags: string[]            // 标签数组
  
  splitRatio: {             // 划分比例
    train: number           // 80
    validation: number      // 10
    test: number            // 10
  }
  
  annotationConfig: {       // 标注配置
    types: AnnotationType[] // 标注类型
    labels: string[]        // 标注标签
    requireReview: boolean  // 需要复核
    minAnnotatorsPerAsset: number // 最少标注人数
  }
  
  assetIds: string[]        // 资产ID数组
}
```

### 创建后的数据集
```typescript
{
  id: string                          // 自动生成
  name: string
  description: string
  version: string
  status: DatasetStatus.DRAFT         // 初始状态: 草稿
  createdBy: string                   // 创建者ID
  createdAt: string                   // ISO时间戳
  updatedAt: string
  
  assets: AssetReference[]            // 资产引用
  totalAssets: number                 // 资产总数
  
  splits: {                           // 实际划分结果
    train: { count, percentage }
    validation: { count, percentage }
    test: { count, percentage }
  }
  
  quality: QualityMetrics             // 质量指标（初始全0）
  statistics: DatasetStatistics       // 统计信息
  annotationConfig: AnnotationConfig  // 标注配置
  exports: []                         // 导出历史（初始为空）
  tags: string[]
  category: string
}
```

---

## 🚀 使用示例

### 场景1: 创建语音交互数据集

**目标**: 为智能座舱语音唤醒功能训练模型

**步骤1 - 基本信息**:
- 名称: `智能座舱语音唤醒数据集`
- 描述: `收集的用户在不同噪音环境下的语音唤醒测试数据，包括成功和失败案例`
- 分类: `语音处理`
- 标签: `语音唤醒`, `噪音环境`, `ASR`, `智能座舱`
- 创建者: 张三（数据工程师）

**步骤2 - 数据配置**:
- 划分: 80% / 10% / 10%
- 标注类型: ✅ 分类标注, ✅ 转录标注
- 标注标签: `成功`, `失败`, `噪音干扰`, `口音问题`
- 质量控制: ✅ 需要复核, 最少2人标注

**步骤3 - 选择资产**:
- 选择: 中型数据集（500个资产）
- 结果: 训练400个, 验证50个, 测试50个

**创建结果**:
```
✅ 数据集创建成功！

数据集名称：智能座舱语音唤醒数据集
创建者：张三
资产数量：500

数据集ID：dataset_1697186400000_abc123
```

---

### 场景2: 创建UI设计检测数据集

**目标**: 训练目标检测模型识别UI组件

**步骤1 - 基本信息**:
- 名称: `智能座舱UI组件检测数据集`
- 描述: `竞品UI界面截图，标注各类UI组件的位置和类型`
- 分类: `图像识别`
- 标签: `UI检测`, `目标检测`, `界面分析`
- 创建者: 李四（AI工程师）

**步骤2 - 数据配置**:
- 划分: 80% / 10% / 10%
- 标注类型: ✅ 目标检测, ✅ 分类标注
- 标注标签: `按钮`, `旋钮`, `仪表盘`, `菜单`, `图标`
- 质量控制: ✅ 需要复核, 最少3人标注

**步骤3 - 选择资产**:
- 选择: 大型数据集（1000个资产）
- 结果: 训练800个, 验证100个, 测试100个

---

## 🎓 最佳实践

### 数据集命名
✅ **好的命名**:
- "智能座舱用户反馈数据集"
- "语音唤醒噪音环境测试数据集"
- "竞品UI组件检测数据集v2"

❌ **不好的命名**:
- "数据集1"
- "test"
- "新建数据集"

### 描述编写
应包含：
1. **数据来源**: 从哪里收集的数据
2. **数据内容**: 包含什么类型的数据
3. **使用目的**: 用于训练什么模型
4. **特殊说明**: 数据特点、注意事项

### 标签使用
- 使用具体、准确的标签
- 包含技术栈标签（NLP、CV、ASR等）
- 包含业务领域标签（智能座舱、用户反馈等）
- 3-6个标签为宜

### 数据划分
- **标准划分**: 80/10/10 - 适用大多数情况
- **快速验证**: 90/5/5 - 数据量少时
- **严格评估**: 70/15/15 - 需要更多验证数据

---

## 🔧 技术实现

### 组件结构
```
CreateDatasetModal.vue
├── Teleport (传送到body)
├── 背景遮罩
└── Modal容器
    ├── 头部
    ├── 步骤指示器
    ├── 表单内容 (3个步骤)
    │   ├── 步骤1: 基本信息
    │   ├── 步骤2: 数据配置
    │   └── 步骤3: 选择资产
    └── 底部操作栏
        ├── 上一步按钮
        ├── 取消按钮
        ├── 下一步按钮
        └── 创建按钮
```

### Props & Emits
```typescript
// Props
show: boolean  // 是否显示Modal

// Emits
close: []                    // 关闭Modal
created: [datasetId: string] // 创建成功，返回数据集ID
```

### 关键方法
```typescript
- addTag()          // 添加标签
- removeTag()       // 移除标签
- addLabel()        // 添加标注标签
- removeLabel()     // 移除标注标签
- selectPreset()    // 选择预设资产
- nextStep()        // 下一步
- previousStep()    // 上一步
- handleSubmit()    // 提交创建
- handleCancel()    // 取消操作
- resetForm()       // 重置表单
```

---

## 📈 后续扩展

### 近期计划
- [ ] **AssetSelector组件** - 从数据湖手动选择资产
- [ ] **预览功能** - 创建前预览数据集配置
- [ ] **模板功能** - 保存和加载配置模板
- [ ] **批量导入** - 从CSV/JSON导入配置

### 长期规划
- [ ] **协作创建** - 多人协作创建大型数据集
- [ ] **增量添加** - 创建后继续添加资产
- [ ] **自动推荐** - AI推荐标注类型和标签
- [ ] **数据验证** - 创建时检查数据质量

---

## ✅ 总结

### 核心价值
1. **降低门槛**: 向导式界面，新手也能快速创建
2. **确保质量**: 严格验证，避免创建低质量数据集
3. **追踪来源**: 记录创建者，便于协作和管理
4. **灵活配置**: 支持多种标注类型和划分比例

### 谁在使用？
- **张三（数据工程师）**: 创建用户反馈分析数据集
- **李四（AI工程师）**: 创建模型训练数据集
- **王五（技术总监）**: 审核和管理数据集

### 创建的数据集去哪里？
1. 显示在数据集列表（`/dataset`）
2. 状态为 DRAFT（草稿）
3. 后续可以添加标注、评估质量
4. 发布后可导出给AI训练平台

---

**🎉 现在就试试创建你的第一个训练数据集吧！**

---

**文档版本**: 1.0  
**最后更新**: 2024-10-13  
**维护者**: Synapse Team

