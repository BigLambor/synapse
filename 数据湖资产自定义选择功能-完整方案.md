# 数据湖资产自定义选择功能 - 完整实现方案

## 📋 项目概述

本文档描述了 Synapse 多模态数据平台中"数据湖资产自定义选择功能"的完整实现方案。该功能允许用户在创建训练数据集时，从数据湖中自主选择已处理完成的多模态资产。

## 🎯 功能目标

1. **用户需求**：在创建训练数据集时，能够精确控制数据集包含哪些资产
2. **核心价值**：提供灵活的资产筛选和多选功能，提升数据集创建的精准度
3. **用户体验**：美观、流畅的 UI 交互，符合现代 Web 应用标准

## 🏗️ 架构设计

### 1. 组件结构

```
synapse/src/components/organisms/
├── AssetSelectorModal.vue       # 新增：资产选择器核心组件
└── CreateDatasetModal.vue       # 修改：集成资产选择器
```

### 2. 数据流

```
用户操作 → CreateDatasetModal (点击"自定义选择")
         ↓
     AssetSelectorModal (资产展示与选择)
         ↓
     从 mockAPI.getAssets() 获取资产列表
         ↓
     用户筛选、搜索、多选资产
         ↓
     确认选择 → 回传 assetIds 和 assets 数组
         ↓
     CreateDatasetModal 接收数据并显示统计信息
```

## 💻 核心实现

### 1. AssetSelectorModal 组件

**文件路径**：`synapse/src/components/organisms/AssetSelectorModal.vue`

#### 主要功能：

##### ✅ 资产展示
- 卡片式布局，每个资产显示：
  - 缩略图/图标 (视频🎥、文档📄、图片🖼️、音频🎵)
  - 资产名称
  - 文件大小和上传时间
  - 处理状态（已完成✅、处理中⏳）
  - 标签（最多显示2个，其他显示+N）
- 响应式网格布局：
  - 小屏：1列
  - 中屏：2列
  - 大屏：3列
  - 超大屏：4列

##### ✅ 多维度筛选
- **类型筛选**：视频、文档、图片、音频
- **状态筛选**：已完成、处理中（默认只显示已完成）
- **搜索功能**：支持按名称和标签搜索
- **排序功能**：最新上传、名称、大小

##### ✅ 多选和批量操作
- **单选**：点击资产卡片进行选择/取消选择
- **全选当前页**：一键选择当前页所有已完成资产
- **清除选择**：清空所有已选资产
- **反选**：反转当前页的选择状态
- **视觉反馈**：
  - 选中资产高亮显示（蓝色边框 + 背景）
  - 右上角显示勾选标记✓
  - 选中遮罩层

##### ✅ 分页功能
- 每页显示 16 个资产
- 智能分页导航（最多显示5页）
- 上一页/下一页按钮
- 当前页高亮显示

##### ✅ 实时统计
- 已选资产数量
- 可用资产总数
- 已选资产总大小

##### ✅ 数据验证
- 只允许选择"已完成"状态的资产
- 选择"处理中"资产时给出提示

#### 核心代码片段：

```vue
<template>
  <Teleport to="body">
    <!-- Modal 弹窗 -->
    <div class="fixed inset-0 z-[60]">
      <!-- 筛选栏 -->
      <div class="筛选和搜索">
        <input v-model="searchQuery" placeholder="搜索..." />
        <select v-model="typeFilter">类型</select>
        <select v-model="statusFilter">状态</select>
        <select v-model="sortBy">排序</select>
      </div>

      <!-- 资产网格 -->
      <div class="grid grid-cols-4">
        <div v-for="asset in paginatedAssets"
             @click="toggleAsset(asset)"
             :class="isSelected(asset.id) ? '选中样式' : ''">
          <!-- 资产卡片内容 -->
        </div>
      </div>

      <!-- 分页 -->
      <div class="分页控件"></div>

      <!-- 底部操作栏 -->
      <div class="底部">
        <button @click="handleCancel">取消</button>
        <button @click="handleConfirm" :disabled="selectedAssets.length === 0">
          确认选择 ({{ selectedAssets.length }})
        </button>
      </div>
    </div>
  </Teleport>
</template>

<script setup lang="ts">
// Props
const props = defineProps<{
  show: boolean
  initialSelection?: string[]
}>()

// Emits
const emit = defineEmits<{
  close: []
  confirm: [assetIds: string[], assets: Asset[]]
}>()

// 响应式状态
const selectedAssets = ref<string[]>([])
const searchQuery = ref('')
const typeFilter = ref('')
const statusFilter = ref('completed')

// 过滤逻辑
const filteredAssets = computed(() => {
  let result = [...allAssets.value]
  // 应用各种过滤条件
  return result
})

// 分页逻辑
const paginatedAssets = computed(() => {
  const start = (currentPage.value - 1) * itemsPerPage
  return filteredAssets.value.slice(start, start + itemsPerPage)
})

// 方法
const toggleAsset = (asset: Asset) => {
  if (asset.status !== 'completed') {
    alert('⚠️ 只能选择已完成处理的资产')
    return
  }
  // 切换选择状态
}

const selectAll = () => { /* 全选逻辑 */ }
const clearSelection = () => { /* 清空逻辑 */ }
const invertSelection = () => { /* 反选逻辑 */ }
const handleConfirm = () => {
  emit('confirm', selectedAssets.value, selectedAssetObjects)
  emit('close')
}
</script>
```

### 2. CreateDatasetModal 组件集成

**文件路径**：`synapse/src/components/organisms/CreateDatasetModal.vue`

#### 修改内容：

##### ✅ 导入资产选择器组件

```typescript
import AssetSelectorModal from './AssetSelectorModal.vue'
import type { Asset } from '@/api/mock/mockData'
```

##### ✅ 添加状态管理

```typescript
const showAssetSelector = ref(false)
const selectedAssetsData = ref<Asset[]>([])
```

##### ✅ 修改预设选择逻辑

```typescript
const selectPreset = (size: 'small' | 'medium' | 'large' | 'custom') => {
  if (size === 'custom') {
    showAssetSelector.value = true  // 打开资产选择器
  } else {
    // 原有的预设逻辑
  }
}
```

##### ✅ 添加回调处理

```typescript
const handleAssetSelectionConfirm = (assetIds: string[], assets: Asset[]) => {
  formData.value.assetIds = assetIds
  selectedAssetCount.value = assetIds.length
  selectedAssetsData.value = assets
  showAssetSelector.value = false
}

const handleAssetSelectionCancel = () => {
  showAssetSelector.value = false
}
```

##### ✅ 添加资产类型分布统计

```typescript
const assetTypeDistribution = computed(() => {
  const distribution: Record<string, number> = {}
  selectedAssetsData.value.forEach(asset => {
    distribution[asset.type] = (distribution[asset.type] || 0) + 1
  })
  return distribution
})
```

##### ✅ 在模板中集成组件

```vue
<template>
  <Teleport to="body">
    <!-- 原有的 CreateDatasetModal 内容 -->
    
    <!-- 步骤3：选择资产 -->
    <div v-show="currentStep === 2">
      <!-- 快速选择按钮组 -->
      <button @click="selectPreset('custom')">
        自定义选择
      </button>
      
      <!-- 资产类型分布统计（自定义选择后显示） -->
      <div v-if="selectedAssetsData.length > 0">
        <div v-for="(count, type) in assetTypeDistribution">
          {{ getTypeIcon(type) }} {{ count }}
        </div>
      </div>
    </div>

    <!-- 资产选择器Modal -->
    <AssetSelectorModal
      :show="showAssetSelector"
      :initial-selection="formData.assetIds"
      @close="handleAssetSelectionCancel"
      @confirm="handleAssetSelectionConfirm"
    />
  </Teleport>
</template>
```

### 3. API 层（无需修改）

现有的 `mockAPI.getAssets()` 已经满足需求，返回所有资产列表。资产选择器在组件内部进行过滤和分页。

## 🎨 UI/UX 设计

### 1. 视觉设计

- **配色方案**：
  - 主色：Primary (#6366f1)
  - 成功：Green (#10b981)
  - 警告：Yellow (#f59e0b)
  - 错误：Red (#ef4444)
  - 背景：Neutral 系列

- **卡片设计**：
  - 圆角：rounded-lg (8px)
  - 边框：2px，未选中时为 neutral-700/50
  - 选中时：border-primary-500 + shadow-lg
  - Hover 效果：border-neutral-600

- **图标系统**：
  - 使用 Emoji 作为视觉元素
  - 统一的图标大小和间距

### 2. 交互设计

- **加载状态**：旋转的加载动画
- **空状态**：友好的提示信息和插图
- **反馈机制**：
  - 选中资产：视觉高亮 + 勾选标记
  - 无效操作：Alert 提示
  - 确认操作：需要选择至少1个资产

- **动画效果**：
  - Modal 进入/退出：淡入淡出 + 缩放
  - 按钮 Hover：颜色过渡
  - 资产选择：边框和背景过渡

### 3. 响应式布局

```css
/* 资产网格 */
.grid {
  grid-template-columns: repeat(1, 1fr);  /* 默认：移动端 */
}

@media (min-width: 768px) {
  .grid {
    grid-template-columns: repeat(2, 1fr);  /* 平板 */
  }
}

@media (min-width: 1024px) {
  .grid {
    grid-template-columns: repeat(3, 1fr);  /* 桌面 */
  }
}

@media (min-width: 1280px) {
  .grid {
    grid-template-columns: repeat(4, 1fr);  /* 大屏 */
  }
}
```

## 📊 功能演示流程

### 用户操作步骤：

1. **进入数据集管理页面**
   - 访问 `/dataset` 路由
   - 点击"创建新数据集"按钮

2. **填写基本信息（步骤1）**
   - 数据集名称、描述
   - 分类、版本、标签

3. **配置数据划分（步骤2）**
   - 训练集/验证集/测试集比例
   - 标注类型和标签

4. **选择资产（步骤3）**
   - 方式1：点击预设按钮（小型/中型/大型）
   - 方式2：点击"自定义选择"按钮 ⭐ **核心功能**

5. **资产选择器操作**
   - ✅ 使用筛选器：类型、状态
   - ✅ 使用搜索：输入关键词
   - ✅ 排序：按上传时间/名称/大小
   - ✅ 点击资产卡片进行选择
   - ✅ 使用批量操作：全选/清除/反选
   - ✅ 查看选择统计：已选数量、总大小
   - ✅ 分页浏览：查看更多资产

6. **确认选择**
   - 点击"确认选择"按钮
   - 返回创建数据集页面
   - 查看资产类型分布统计

7. **完成创建**
   - 点击"创建数据集"按钮
   - 系统创建数据集
   - 显示成功提示

## 🔧 技术栈

- **框架**：Vue 3 (Composition API)
- **类型**：TypeScript
- **样式**：Tailwind CSS
- **状态管理**：Pinia
- **构建工具**：Vite

## 📁 文件清单

### 新增文件：
1. `synapse/src/components/organisms/AssetSelectorModal.vue` - 资产选择器组件（完整实现）

### 修改文件：
1. `synapse/src/components/organisms/CreateDatasetModal.vue` - 集成资产选择器

### 相关文件（无需修改）：
1. `synapse/src/api/mock/mockAPI.ts` - 提供 getAssets() 接口
2. `synapse/src/api/mock/mockData.ts` - 提供 mockAssets 数据
3. `synapse/src/stores/dataset.ts` - 数据集状态管理
4. `synapse/src/types/models.ts` - 类型定义

## 🎯 功能特性总结

### ✅ 已实现功能

| 功能模块 | 具体功能 | 状态 |
|---------|---------|------|
| **资产展示** | 卡片式布局 | ✅ |
|  | 资产信息展示（名称、大小、时间、状态、标签） | ✅ |
|  | 响应式网格（1-4列） | ✅ |
|  | 资产类型图标 | ✅ |
| **筛选功能** | 类型筛选（视频/文档/图片/音频） | ✅ |
|  | 状态筛选（已完成/处理中） | ✅ |
|  | 搜索功能（名称/标签） | ✅ |
|  | 排序功能（时间/名称/大小） | ✅ |
| **多选功能** | 单个资产选择/取消 | ✅ |
|  | 全选当前页 | ✅ |
|  | 清除所有选择 | ✅ |
|  | 反选当前页 | ✅ |
|  | 只能选择已完成资产 | ✅ |
| **分页功能** | 分页导航 | ✅ |
|  | 智能页码显示 | ✅ |
|  | 上一页/下一页 | ✅ |
| **视觉反馈** | 选中高亮 | ✅ |
|  | 勾选标记 | ✅ |
|  | Hover 效果 | ✅ |
|  | 加载状态 | ✅ |
|  | 空状态提示 | ✅ |
| **统计信息** | 已选数量 | ✅ |
|  | 可用数量 | ✅ |
|  | 总大小 | ✅ |
|  | 类型分布 | ✅ |
| **集成功能** | CreateDatasetModal 集成 | ✅ |
|  | 数据回传 | ✅ |
|  | 统计展示 | ✅ |

## 🚀 使用说明

### 开发环境启动

```bash
cd /Users/isadmin/StudyCursor/synapse/synapse
npm install
npm run dev
```

### 访问路径

1. 主页：`http://localhost:5173/`
2. 数据集管理：`http://localhost:5173/dataset`
3. 点击"创建新数据集" → 步骤3 → "自定义选择"

### 测试场景

#### 场景1：基本选择流程
1. 打开资产选择器
2. 浏览资产列表
3. 点击3-5个资产进行选择
4. 确认选择
5. 验证数据是否正确回传

#### 场景2：筛选功能
1. 打开资产选择器
2. 选择类型为"视频"
3. 验证只显示视频资产
4. 搜索关键词"用户"
5. 验证搜索结果正确

#### 场景3：批量操作
1. 打开资产选择器
2. 点击"全选当前页"
3. 验证当前页所有已完成资产被选中
4. 点击"反选"
5. 验证选择状态反转

#### 场景4：分页浏览
1. 打开资产选择器
2. 浏览第1页，选择2个资产
3. 翻到第2页，选择3个资产
4. 验证总共选择了5个资产
5. 确认选择

#### 场景5：数据验证
1. 打开资产选择器
2. 尝试选择"处理中"的资产
3. 验证出现警告提示
4. 只选择"已完成"资产
5. 确认选择成功

## 💡 设计亮点

1. **用户体验优先**
   - 直观的视觉反馈
   - 流畅的交互动画
   - 清晰的操作提示

2. **功能完整性**
   - 多维度筛选
   - 强大的批量操作
   - 智能分页

3. **代码质量**
   - TypeScript 类型安全
   - 组件化设计
   - 响应式架构

4. **性能优化**
   - 计算属性缓存
   - 虚拟滚动（可扩展）
   - 按需加载

## 📈 扩展建议

### 短期优化：
1. 添加资产预览功能
2. 支持拖拽排序
3. 支持快捷键操作
4. 添加收藏/标签功能

### 长期规划：
1. 虚拟滚动优化大量数据
2. 高级筛选（日期范围、大小范围）
3. 批量标签编辑
4. 导出选择列表
5. 历史选择记录

## 🎉 总结

本方案完整实现了"数据湖资产自定义选择功能"，提供了：

- ✅ 美观现代的 UI 设计
- ✅ 完善的交互体验
- ✅ 强大的筛选和多选功能
- ✅ 良好的代码架构
- ✅ 完整的类型安全

该功能已集成到创建数据集流程中，用户可以灵活地从数据湖中选择资产，提升了数据集创建的精准度和效率。

---

**实现时间**：2024-10-19
**实现人员**：AI Assistant
**文档版本**：v1.0

